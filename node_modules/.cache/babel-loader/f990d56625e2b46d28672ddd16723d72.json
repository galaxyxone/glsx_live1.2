{"ast":null,"code":"import _objectSpread from \"/Users/kalyke/Downloads/Latest_Code (2)/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nimport _classCallCheck from \"/Users/kalyke/Downloads/Latest_Code (2)/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/kalyke/Downloads/Latest_Code (2)/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport auth0 from \"auth0-js\";\n\nvar Auth = /*#__PURE__*/function () {\n  function Auth(history) {\n    var _this = this;\n\n    _classCallCheck(this, Auth);\n\n    this.login = function () {\n      _this.auth0.authorize();\n    };\n\n    this.handleAuthentication = function () {\n      _this.auth0.parseHash(function (err, authResult) {\n        if (authResult && authResult.accessToken && authResult.idToken) {\n          _this.setSession(authResult);\n\n          _this.history.push(\"/\");\n        } else if (err) {\n          _this.history.push(\"/\");\n\n          alert(\"Error: \".concat(err.error, \". Check the console for further details.\"));\n          console.log(err);\n        }\n      });\n    };\n\n    this.setSession = function (authResult) {\n      // set the time that the access token will expire\n      var expiresAt = JSON.stringify(authResult.expiresIn * 1000 + new Date().getTime());\n      localStorage.setItem(\"access_token\", authResult.accessToken);\n      localStorage.setItem(\"id_token\", authResult.idToken);\n      localStorage.setItem(\"expires_at\", expiresAt);\n\n      _this.updateMetaData();\n    };\n\n    this.logout = function () {\n      localStorage.removeItem(\"access_token\");\n      localStorage.removeItem(\"id_token\");\n      localStorage.removeItem(\"expires_at\");\n      _this.userProfile = null;\n\n      _this.auth0.logout({\n        clientID: process.env.REACT_APP_AUTH0_CLIENT_ID,\n        returnTo: \"https://main.d68xr13qmy8ol.amplifyapp.com\"\n      });\n    };\n\n    this.getAccessToken = function () {\n      var accessToken = localStorage.getItem(\"access_token\");\n\n      if (!accessToken) {\n        throw new Error(\"No access token found.\");\n      }\n\n      return accessToken;\n    };\n\n    this.getProfile = function (cb) {\n      if (_this.userProfile) return cb(_this.userProfile);\n\n      _this.auth0.client.userInfo(_this.getAccessToken(), function (err, profile) {\n        var new_profile = {};\n\n        if (profile) {\n          new_profile = profile;\n\n          _this.getUserMetaData(profile).then(function (data) {\n            return data;\n          }).then(function (data) {\n            new_profile = _objectSpread({}, profile, data);\n            _this.userProfile = _objectSpread({}, profile, data);\n            cb(new_profile);\n          });\n        }\n\n        cb(new_profile, err);\n      });\n    };\n\n    this.updateMetaData = function () {\n      var meta = \"0xc92E7DDfF00fbd6A91d7984B0c72aEd0b5556562\";\n      fetch(\"/user/manifestCustomer\", {\n        method: \"POST\",\n        headers: {\n          Authorization: \"Bearer \" + _this.getAccessToken()\n        },\n        body: {\n          address: meta\n        },\n        json: true\n      }).then(function (response) {\n        if (response.ok) return response.json();\n        return {};\n      }).then(function (response) {\n        return response;\n      }).catch(function (error) {\n        console.log({\n          error: error\n        });\n        return {};\n      });\n    };\n\n    this.getUserMetaData = function (profile) {\n      return fetch(\"/user/get_user\", {\n        method: \"get\",\n        headers: {\n          Authorization: \"Bearer \" + _this.getAccessToken()\n        },\n        json: true\n      }).then(function (response) {\n        if (response.ok) {\n          return response.json();\n        }\n      }).then(function (data) {\n        return data;\n      }).catch(function (error) {\n        return {};\n      });\n    };\n\n    this.history = history;\n    this.userProfile = null;\n    this.auth0 = new auth0.WebAuth({\n      domain: process.env.REACT_APP_AUTH0_DOMAIN,\n      clientID: process.env.REACT_APP_AUTH0_CLIENT_ID,\n      redirectUri: process.env.REACT_APP_AUTH0_CALLBACK_URL,\n      audience: process.env.REACT_APP_AUTH0_AUDIENCE,\n      responseType: \"token id_token\",\n      scope: \"openid profile email\"\n    });\n  }\n\n  _createClass(Auth, [{\n    key: \"isAuthenticated\",\n    value: function isAuthenticated() {\n      var expiresAt = JSON.parse(localStorage.getItem(\"expires_at\"));\n      return new Date().getTime() < expiresAt;\n    }\n  }]);\n\n  return Auth;\n}();\n\nexport { Auth as default };","map":{"version":3,"sources":["/Users/kalyke/Downloads/Latest_Code (2)/src/Auth/Auth.js"],"names":["auth0","Auth","history","login","authorize","handleAuthentication","parseHash","err","authResult","accessToken","idToken","setSession","push","alert","error","console","log","expiresAt","JSON","stringify","expiresIn","Date","getTime","localStorage","setItem","updateMetaData","logout","removeItem","userProfile","clientID","process","env","REACT_APP_AUTH0_CLIENT_ID","returnTo","getAccessToken","getItem","Error","getProfile","cb","client","userInfo","profile","new_profile","getUserMetaData","then","data","meta","fetch","method","headers","Authorization","body","address","json","response","ok","catch","WebAuth","domain","REACT_APP_AUTH0_DOMAIN","redirectUri","REACT_APP_AUTH0_CALLBACK_URL","audience","REACT_APP_AUTH0_AUDIENCE","responseType","scope","parse"],"mappings":"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","sourcesContent":["import auth0 from \"auth0-js\";\n\nexport default class Auth {\n  constructor(history) {\n    this.history = history;\n    this.userProfile = null;\n    this.auth0 = new auth0.WebAuth({\n      domain: process.env.REACT_APP_AUTH0_DOMAIN,\n      clientID: process.env.REACT_APP_AUTH0_CLIENT_ID,\n      redirectUri: process.env.REACT_APP_AUTH0_CALLBACK_URL,\n      audience: process.env.REACT_APP_AUTH0_AUDIENCE,\n      responseType: \"token id_token\",\n      scope: \"openid profile email\",\n    });\n  }\n\n  login = () => {\n    this.auth0.authorize();\n  };\n\n  handleAuthentication = () => {\n    this.auth0.parseHash((err, authResult) => {\n      if (authResult && authResult.accessToken && authResult.idToken) {\n        this.setSession(authResult);\n\n        this.history.push(\"/\");\n      } else if (err) {\n        this.history.push(\"/\");\n        alert(`Error: ${err.error}. Check the console for further details.`);\n        console.log(err);\n      }\n    });\n  };\n\n  setSession = (authResult) => {\n    // set the time that the access token will expire\n    const expiresAt = JSON.stringify(\n      authResult.expiresIn * 1000 + new Date().getTime()\n    );\n\n    localStorage.setItem(\"access_token\", authResult.accessToken);\n    localStorage.setItem(\"id_token\", authResult.idToken);\n    localStorage.setItem(\"expires_at\", expiresAt);\n\n    this.updateMetaData();\n  };\n\n  isAuthenticated() {\n    const expiresAt = JSON.parse(localStorage.getItem(\"expires_at\"));\n    return new Date().getTime() < expiresAt;\n  }\n\n  logout = () => {\n    localStorage.removeItem(\"access_token\");\n    localStorage.removeItem(\"id_token\");\n    localStorage.removeItem(\"expires_at\");\n    this.userProfile = null;\n    this.auth0.logout({\n      clientID: process.env.REACT_APP_AUTH0_CLIENT_ID,\n      returnTo: \"https://main.d68xr13qmy8ol.amplifyapp.com\",\n    });\n  };\n\n  getAccessToken = () => {\n    const accessToken = localStorage.getItem(\"access_token\");\n    if (!accessToken) {\n      throw new Error(\"No access token found.\");\n    }\n    return accessToken;\n  };\n\n  getProfile = (cb) => {\n    if (this.userProfile) return cb(this.userProfile);\n    this.auth0.client.userInfo(this.getAccessToken(), (err, profile) => {\n      let new_profile = {};\n      if (profile) {\n        new_profile = profile;\n        this.getUserMetaData(profile)\n          .then((data) => data)\n          .then((data) => {\n            new_profile = { ...profile, ...data };\n            this.userProfile = { ...profile, ...data };\n            cb(new_profile);\n          });\n      }\n      cb(new_profile, err);\n    });\n  };\n  updateMetaData = () => {\n    const meta = \"0xc92E7DDfF00fbd6A91d7984B0c72aEd0b5556562\";\n    fetch(\"/user/manifestCustomer\", {\n      method: \"POST\",\n      headers: {\n        Authorization: \"Bearer \" + this.getAccessToken(),\n      },\n      body: {\n        address: meta,\n      },\n      json: true,\n    })\n      .then((response) => {\n        if (response.ok) return response.json();\n        return {};\n      })\n      .then((response) => response)\n      .catch((error) => {\n        console.log({ error });\n        return {};\n      });\n  };\n\n  getUserMetaData = (profile) => {\n    return fetch(\"/user/get_user\", {\n      method: \"get\",\n      headers: {\n        Authorization: \"Bearer \" + this.getAccessToken(),\n      },\n      json: true,\n    })\n      .then((response) => {\n        if (response.ok) {\n          return response.json();\n        }\n      })\n      .then((data) => {\n        return data;\n      })\n      .catch((error) => {\n        return {};\n      });\n  };\n}\n"]},"metadata":{},"sourceType":"module"}